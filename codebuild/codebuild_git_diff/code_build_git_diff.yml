version: 0.2

env:
  shell: bash

phases:
  pre_build:
    commands:
      - echo Assuming role into target AWS account for deployment
      - echo '[INFO] testing...'
      - ls
      # - role_arn="arn:aws:iam::${AWS_ACCOUNT_ID}:role/${ROLE_NAME}"
      # - TF_DEPLOYER_ROLE=`aws sts assume-role --role-arn $role_arn --role-session-name concourse-task`
      # - export AWS_ACCESS_KEY_ID=`echo "${TF_DEPLOYER_ROLE}" | jq -r '.Credentials.AccessKeyId'`
      # - export AWS_SECRET_ACCESS_KEY=`echo "${TF_DEPLOYER_ROLE}" | jq -r '.Credentials.SecretAccessKey'`
      # - export AWS_SESSION_TOKEN=`echo "${TF_DEPLOYER_ROLE}" | jq -r '.Credentials.SessionToken'`
      # - aws sts get-caller-identity
  build:
    commands:
      - echo outputting git diff file...
      - ls
      # - # cd $CODEBUILD_SRC_DIR
      # - ./bin/get_pr_changed_files_list.sh ${REPO_NAME} ${OUTPUT_FILENAME}
  post_build:
    commands:
      - echo test
      - ls

# artifacts:
#   secondary-artifacts:
#     git-diff-file:
#       base-directory: $CODEBUILD_SRC_DIR
#       files: 
#         - ${OUTPUT_FILENAME}
